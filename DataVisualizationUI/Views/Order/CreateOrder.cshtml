@model DataVisualizationUI.Dtos.CreateOrderDto

@{
    ViewData["Title"] = "Yeni Sipariş";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Page Info (Sayfa Bilgisi) -->
<div class="mb-8 pl-1">
    <h1 class="text-3xl font-bold text-white">Yeni Sipariş</h1>
    <p class="text-gray-400 mt-1 text-sm">Sisteme yeni bir sipariş girişi yapın.</p>
</div>

<!-- Form Card (Form Kartı) -->
<div class="bg-dark-800 rounded-xl border border-dark-700 shadow-xl p-8 max-w-4xl mx-auto">
    
    <form asp-controller="Order" asp-action="CreateOrder" method="post">
        
        <!-- Validation Summary (Doğrulama Özeti) -->
        <div asp-validation-summary="ModelOnly" class="mb-4 p-4 bg-red-500/10 border border-red-500/30 rounded-lg text-red-400 text-sm"></div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <!-- Customer Selection (Müşteri Seçimi) -->
            <div>
                <label class="block text-sm font-medium text-gray-400 mb-2">Müşteri</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500 z-10 pointer-events-none">
                        <i class="fa-solid fa-user"></i>
                    </span>
                    <select asp-for="CustomerId" class="w-full" required>
                        <option value="">Müşteri Ara...</option>
                    </select>
                </div>
            </div>

            <!-- Product Selection (Ürün Seçimi) -->
            <div>
                <label class="block text-sm font-medium text-gray-400 mb-2">Ürün</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500 z-10 pointer-events-none">
                        <i class="fa-solid fa-box"></i>
                    </span>
                    <select asp-for="ProductId" class="w-full" required>
                        <option value="">Ürün Ara...</option>
                    </select>
                </div>
            </div>

            <!-- Quantity (Adet) -->
            <div>
                <label class="block text-sm font-medium text-gray-400 mb-2">Adet</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">
                        <i class="fa-solid fa-layer-group"></i>
                    </span>
                    <input type="number" asp-for="Quantity" class="w-full bg-dark-900 border border-dark-700 rounded-lg pl-10 pr-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all" placeholder="1" min="1" required />
                </div>
            </div>

            <!-- Payment Method (Ödeme Yöntemi) -->
            <div>
                <label class="block text-sm font-medium text-gray-400 mb-2">Ödeme Yöntemi</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">
                        <i class="fa-solid fa-credit-card"></i>
                    </span>
                    <select asp-for="PaymentMethod" class="w-full bg-dark-900 border border-dark-700 rounded-lg pl-10 pr-4 py-3 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all appearance-none" required>
                        <option value="">Seçiniz</option>
                        <option value="Kredi Kartı">Kredi Kartı</option>
                        <option value="Banka Kartı">Banka Kartı</option>
                        <option value="Kapıda Ödeme">Kapıda Ödeme</option>
                        <option value="Havale/EFT">Havale/EFT</option>
                        <option value="Google Pay">Google Pay</option>
                        <option value="Apple Pay">Apple Pay</option>
                        <option value="PayPal">PayPal</option>
                    </select>
                    <span class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-500">
                        <i class="fa-solid fa-chevron-down text-xs"></i>
                    </span>
                </div>
            </div>

             <!-- Order Status (Sipariş Durumu) -->
            <div>
                <label class="block text-sm font-medium text-gray-400 mb-2">Sipariş Durumu</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">
                        <i class="fa-solid fa-clipboard-check"></i>
                    </span>
                    <select asp-for="OrderStatus" class="w-full bg-dark-900 border border-dark-700 rounded-lg pl-10 pr-4 py-3 text-white focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all appearance-none" required>
                        <option value="Hazırlanıyor">Hazırlanıyor</option>
                        <option value="Kargoda">Kargoda</option>
                        <option value="Tamamlandı">Tamamlandı</option>
                        <option value="İptal Edildi">İptal Edildi</option>
                        <option value="Beklemede">Beklemede</option>
                    </select>
                    <span class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-500">
                        <i class="fa-solid fa-chevron-down text-xs"></i>
                    </span>
                </div>
            </div>

            <!-- Order Date (Sipariş Tarihi) -->
            <div>
                <label class="block text-sm font-medium text-gray-400 mb-2">Sipariş Tarihi</label>
                <div class="relative">
                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">
                        <i class="fa-solid fa-calendar"></i>
                    </span>
                    <input type="datetime-local" asp-for="OrderDate" class="w-full bg-dark-900 border border-dark-700 rounded-lg pl-10 pr-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all" value="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm")" required />
                </div>
            </div>

            <!-- Order Notes (Sipariş Notları) -->
             <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-400 mb-2">Sipariş Notu</label>
                <div class="relative">
                    <span class="absolute top-3 left-0 pl-3 flex items-start text-gray-500">
                        <i class="fa-solid fa-note-sticky"></i>
                    </span>
                    <textarea asp-for="OrderNotes" rows="3" class="w-full bg-dark-900 border border-dark-700 rounded-lg pl-10 pr-4 py-3 text-white placeholder-gray-600 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all" placeholder="Eklenecek notlar..."></textarea>
                </div>
            </div>

        </div>

        <!-- Action Buttons (İşlem Butonları) -->
        <div class="flex items-center gap-4 mt-8 border-t border-dark-700 pt-6">
            <button type="submit" class="bg-primary hover:bg-indigo-600 text-white font-medium py-2.5 px-6 rounded-lg shadow-lg shadow-indigo-500/30 transform active:scale-95 transition-all flex items-center gap-2">
                <i class="fa-solid fa-check"></i> Kaydet
            </button>
            <a href="/Order/OrderList" class="text-gray-400 hover:text-white hover:bg-dark-700 font-medium py-2.5 px-6 rounded-lg transition-colors">
                İptal
            </a>
        </div>

    </form>
</div>

<!-- Select2 Resources (Select2 Kaynakları) -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<style>
    /* Select2 Dark Theme Customization (Select2 Koyu Tema Özelleştirmesi) */
    .select2-container--default .select2-selection--single {
        background-color: #111827 !important; /* bg-dark-900 */
        border-color: #374151 !important; /* border-dark-700 */
        color: #fff !important;
        height: 50px !important;
        border-radius: 0.5rem !important; /* rounded-lg */
        padding-left: 2.5rem !important; /* Space for icon */
        display: flex !important;
        align-items: center !important;
    }

    .select2-container--default .select2-selection--single .select2-selection__rendered {
        color: #fff !important;
        line-height: normal !important;
        padding-left: 0 !important;
    }

    .select2-container--default .select2-selection--single .select2-selection__arrow {
        height: 48px !important;
        right: 10px !important;
    }

    .select2-dropdown {
        background-color: #1f2937 !important; /* bg-dark-800 */
        border-color: #374151 !important;
        color: #fff !important;
    }

    .select2-container--default .select2-results__option--highlighted.select2-results__option--selectable {
        background-color: #4f46e5 !important; /* primary color */
        color: white !important;
    }

    .select2-container--default .select2-results__option--selected {
        background-color: #374151 !important;
    }
    
    .select2-search--dropdown .select2-search__field {
        background-color: #111827 !important;
        border-color: #374151 !important;
        color: #fff !important;
        border-radius: 0.25rem !important;
    }
    
    /* Hide original arrow to avoid double icons, or adjust */
    /* We kept the icon in the HTML (absolute) so we need to make sure Select2 text doesn't overlap or we hide the HTML icon. 
       Actually, Select2 replaces the select. The icon I added <span><i class="fa-user">...</span> is absolute over the container.
       We need to ensure Select2 container sits nicely under it. 
       My CSS above adds padding-left: 2.5rem which matches the HTML icon spacing.
    */
</style>

<script>
    $(document).ready(function() {
        $('#CustomerId').select2({
            placeholder: "Müşteri Ara...",
            allowClear: true,
            ajax: {
                url: '/Order/SearchCustomers',
                dataType: 'json',
                delay: 250,
                data: function (params) {
                    return {
                        term: params.term // search term
                    };
                },
                processResults: function (data) {
                    return {
                        results: data.results
                    };
                },
                cache: true
            },
            minimumInputLength: 0,
            language: {
                noResults: function() {
                    return "Müşteri bulunamadı";
                },
                searching: function() {
                    return "Aranıyor...";
                }
            }
        });

        $('#ProductId').select2({
            placeholder: "Ürün Ara...",
            allowClear: true,
            ajax: {
                url: '/Order/SearchProducts',
                dataType: 'json',
                delay: 250,
                data: function (params) {
                    return {
                        term: params.term // search term
                    };
                },
                processResults: function (data) {
                    return {
                        results: data.results
                    };
                },
                cache: true
            },
            minimumInputLength: 0,
            language: {
                noResults: function() {
                    return "Ürün bulunamadı";
                },
                searching: function() {
                    return "Aranıyor...";
                }
            }
        });
    });
</script>
