@using DataVisualizationUI.Models.DashboardViewModels
@model DashboardListsViewModel

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">

    <!-- Top Selling Products (Çok Satan Ürünler) -->
    <div class="bg-dark-800 rounded-xl border border-dark-700 shadow-lg flex flex-col">
        <div class="p-6 border-b border-dark-700 flex justify-between items-center">
            <h3 class="text-white font-bold text-lg flex items-center gap-2">
                <i class="fa-solid fa-trophy text-amber-500"></i> Çok Satan Ürünler
            </h3>
            <span class="bg-dark-700 text-gray-300 text-xs px-2 py-1 rounded">Top 5</span>
        </div>
        <div class="p-6 overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="text-gray-400 text-xs uppercase border-b border-dark-700">
                        <th class="pb-3 font-semibold pl-2">Ürün</th>
                        <th class="pb-3 font-semibold text-center">Adet</th>
                        <th class="pb-3 font-semibold text-right pr-2">Ciro</th>
                    </tr>
                </thead>
                <tbody class="align-middle">
                    @if (Model.TopSellingProducts != null && Model.TopSellingProducts.Any())
                    {
                        @foreach (var item in Model.TopSellingProducts)
                        {
                            <tr class="hover:bg-dark-700/30 transition-colors group border-b border-dark-700/50 last:border-0">
                                <td class="py-3 pl-2">
                                    <div class="flex items-center gap-3">
                                        @if (!string.IsNullOrEmpty(item.ImageUrl))
                                        {
                                            <img src="@item.ImageUrl" alt="@item.ProductName" class="h-10 w-10 rounded-lg object-cover border border-dark-600 group-hover:border-amber-500/50 transition-colors" />
                                        }
                                        else
                                        {
                                            <div class="h-10 w-10 rounded-lg bg-dark-700 flex items-center justify-center text-gray-500">
                                                <i class="fa-solid fa-box"></i>
                                            </div>
                                        }
                                        <div>
                                            <p class="font-medium text-white text-sm">@item.ProductName</p>
                                            <p class="text-xs text-gray-500">@item.CategoryName</p>
                                        </div>
                                    </div>
                                </td>
                                <td class="py-3 text-center">
                                    <span class="inline-flex items-center justify-center px-2 py-1 bg-amber-500/10 text-amber-500 text-xs font-bold rounded-full min-w-[30px]">
                                        @item.TotalSold
                                    </span>
                                </td>
                                <td class="py-3 text-right pr-2">
                                    <span class="text-gray-300 text-sm font-mono">@item.TotalRevenue.ToString("C", System.Globalization.CultureInfo.GetCultureInfo("fr-FR"))</span>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                             <td colspan="3" class="py-4 text-center text-gray-500 text-sm">Veri bulunamadı.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Critical Stock Alerts (Kritik Stok Uyarıları) -->
    <div class="bg-dark-800 rounded-xl border border-dark-700 shadow-lg flex flex-col">
          <div class="p-6 border-b border-dark-700 flex justify-between items-center">
            <h3 class="text-white font-bold text-lg flex items-center gap-2">
                <i class="fa-solid fa-triangle-exclamation text-red-500"></i> Kritik Stok Uyarıları
            </h3>
             <a href="/Product/ProductList" class="text-xs text-blue-400 hover:text-blue-300 transition-colors">Tümünü Gör</a>
        </div>
         <div class="p-6 overflow-x-auto">
             <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="text-gray-400 text-xs uppercase border-b border-dark-700">
                        <th class="pb-3 font-semibold pl-2">Ürün</th>
                        <th class="pb-3 font-semibold w-32">Stok Durumu</th>
                        <th class="pb-3 font-semibold text-right pr-2">Adet</th>
                    </tr>
                </thead>
                <tbody class="align-middle">
                     @if (Model.LowStockProducts != null && Model.LowStockProducts.Any())
                    {
                        @foreach (var item in Model.LowStockProducts)
                        {
                            // Calculate percentage for progress bar (assuming 20 is threshold, max nice-to-have is 50?) (İlerleme çubuğu için yüzdeyi hesapla (20'nin eşik olduğunu varsayarsak, maksimum olması gereken 50?))
                            var percentage = (item.StockQuantity / 20.0) * 100; 
                            if(percentage > 100) percentage = 100;
                            var colorClass = item.StockQuantity <= 5 ? "bg-red-500" : "bg-orange-500";

                            <tr class="hover:bg-dark-700/30 transition-colors group border-b border-dark-700/50 last:border-0">
                                <td class="py-3 pl-2">
                                     <div class="flex items-center gap-3">
                                        @if (!string.IsNullOrEmpty(item.ImageUrl))
                                        {
                                            <img src="@item.ImageUrl" alt="@item.ProductName" class="h-10 w-10 rounded-lg object-cover border border-dark-600 group-hover:border-red-500/50 transition-colors" />
                                        }
                                        else
                                        {
                                            <div class="h-10 w-10 rounded-lg bg-dark-700 flex items-center justify-center text-gray-500">
                                                <i class="fa-solid fa-box"></i>
                                            </div>
                                        }
                                        <span class="font-medium text-white text-sm truncate max-w-[150px]">@item.ProductName</span>
                                    </div>
                                </td>
                                <td class="py-3">
                                    <div class="w-full bg-dark-900 rounded-full h-1.5 mb-1 border border-dark-700">
                                        <div class="@colorClass h-1.5 rounded-full" style="width: @percentage%"></div>
                                    </div>
                                    <span class="text-[10px] text-gray-500">
                                        @if(item.StockQuantity == 0) { <span class="text-red-500 font-bold">Tükendi</span> }
                                        else if(item.StockQuantity <= 5) { <span class="text-red-400">Çok Kritik</span> }
                                        else { <span>Azalıyor</span> }
                                    </span>
                                </td>
                                 <td class="py-3 text-right pr-2">
                                    <span class="inline-flex items-center justify-center px-2 py-1 bg-red-500/10 text-red-500 text-xs font-bold rounded-lg min-w-[30px]">
                                        @item.StockQuantity
                                    </span>
                                </td>
                            </tr>
                        }
                    }
                     else
                    {
                        <tr>
                             <td colspan="3" class="py-4 text-center text-gray-500 text-sm">Kritik stok uyarısı yok.</td>
                        </tr>
                    }
                </tbody>
             </table>
         </div>
    </div>

</div>
